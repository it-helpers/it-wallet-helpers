{
  "openapi": "3.0.2",
  "info": {
    "title": "IT Wallet API - Service Provider SAML",
    "description": "API for the Italian EUDI Wallet implementation profile (version: '0.6.0') <a target=\"blank\" href=\"https://italia.github.io/eudi-wallet-it-docs/v0.6.0/en/\">https://italia.github.io/eudi-wallet-it-docs/v0.6.0/en/</a>",
    "version": "0.6.0"
  },
  "servers": [
    {
      "url": "https://api.server.test/it-wallet-api/v0.6.0",
      "description": "Main (production) server"
    }
  ],
  "paths": {
    "/login": {
      "get": {
        "tags": [
          "SP SAML"
        ],
        "summary": "The SP SAML endpoint for requesting a user login to a specific SAML IdP",
        "operationId": "login",
        "parameters": [
          {
            "name": "state",
            "in": "cookie",
            "description": "Contains the unique application session identifier at the Wallet Instance side",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "fyZiOL9Lf2CeKuNT2JzxiLRDink0uPcd"
          },
          {
            "name": "idphint",
            "in": "query",
            "description": "The identifier of the hinted Identity Provider (entityID), in URL-encoded format",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            },
            "example": "https%3A%2F%2Fidp.example.org"
          },
          {
            "name": "target",
            "in": "query",
            "description": "Redirection URI of the SP, in URL-encoded format, to which the SP Assertion Consumer Service redirects the Wallet Instance with the verified SAML Response (SP forward the request to the /authorization endpoint of the authorization server of eID Provider translating the SAML assertion to text plane values in HTTP heades).",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            },
            "example": "https%3A%2F%2Fwallet-sp.ipzs.it%2Fcallback"
          }
        ],
        "responses": {
          "302": {
            "description": "Found  <br> <br/> <b>No content</b> <br/><br/>=> EXAMPLE Location Header: <br/><br/> https%3A%2F%2Fidp.example.org%2Fsaml2-sso%3FSAMLRequest%3DPHNhbWxwOkxvZ291dFJlcXVlc3QgeG1sbnM6c2FtbHA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCIgeG1sbnM9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iCiAgICBJRD0iZDJiN2MzODhjZWMzNmZhN2MzOWMyOGZkMjk4NjQ0YTgiIElzc3VlSW5zdGFudD0iMjAwNC0wMS0yMVQxOTowMDo0OVoiIFZlcnNpb249IjIuMCI%2BCiAgICA8SXNzdWVyPmh0dHBzOi8vSWRlbnRpdHlQcm92aWRlci5jb20vU0FNTDwvSXNzdWVyPgogICAgPE5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnBlcnNpc3RlbnQiPjAwNWEwNmUwLWFkODItMTEwZC1hNTU2LTAwNDAwNWIxM2EyYjwvTmFtZUlEPgogICAgPHNhbWxwOlNlc3Npb25JbmRleD4xPC9zYW1scDpTZXNzaW9uSW5kZXg%2BCjwvc2FtbHA6TG9nb3V0UmVxdWVzdD4K%26Signature%3DJ4if7CCeHVfn4H6hMZN5fijOjQIyZ%2FlaoFUZWz4LCRN3J82UeoyYvAiTDoQOUZHTRJNU1lWGub1pW4QR9MH5bwfLEa8XDivA118dR0Q7YN5L%2FU5rmbxnGlQ9pV0jT44cRNeqtbLW0YF4plfcqg7E5iOSljE3QLkiaAdkAec2a4HwPFkn%2FJP7wO11Mc6kU8MLCBbZAa3%2B94ZvVwHBEdyCdU%2B1yEvf%2BJGxTw66BwI2ugmPfxvoJdsOOAWwS3KhAFhLLSPXnhb3nd%2FovKNNV%2FkhZYwqsFTFNTMA%2B0JraKsZiCRtEZzEPXaP9KilrjPIIvRVxDQhETj96flk5zMkEM3ruw%26SigAlg%3Dhttp%3A%2F%2Fwww.w3.org%2F2000%2F09%2Fxmldsig%23rsa-sha1%26RelayState%3D0043bfc1bc45110dae17004005b13a2b",
            "headers": {
              "Location": {
                "description": "The Location response header indicates the URL of Identity Provider SSO service to redirect the web view of the Wallet Instance to.<br/><br/>This URL present in query string: <ul><li>SAMLRequest (SAML authorization request)</li><li>Signature </i></li><li>SigAlg (signature algorithm)</li><li>RelayState (login request id) </li></ul>",
                "schema": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "Set-Cookie": {
                "description": "Contains the unique application session identifier at the SP side",
                "schema": {
                  "type": "string",
                  "example": "_opensaml_req_ss=057a4fbbb54c7d1daa09583703345565bd343546;Path=/;HttpOnly;Secure"
                }
              }
            }
          },
          "200": {
            "description": "Ok",
            "content": {
              "text/html": {
                "example": "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.1//EN' 'http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml'xml:lang='en'>\n<body onload='document.forms[0].submit()'>\n<noscript>\n<p>\n<strong>Note:</strong> Poiché il tuo browser non supporta JavaScript, devi premere il pulsante Continua una volta per procedere.\n</p>\n</noscript>\n<form action='https://idp.example.org/saml2-sso' method='post'>\n<div>\n<input type='hidden' name='RelayState' value='0043bfc1bc45110dae17004005b13a2b'/>\n<input type='hidden' name='SAMLRequest' value='PHNhbWxwOkxvZ291dFJlcXVlc3QgeG1sbnM6c2FtbHA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCIgeG1sbnM9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iCiAgICBJRD0iZDJiN2MzODhjZWMzNmZhN2MzOWMyOGZkMjk4NjQ0YTgiIElzc3VlSW5zdGFudD0iMjAwNC0wMS0yMVQxOTowMDo0OVoiIFZlcnNpb249IjIuMCI+CiAgICA8SXNzdWVyPmh0dHBzOi8vSWRlbnRpdHlQcm92aWRlci5jb20vU0FNTDwvSXNzdWVyPgogICAgPE5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnBlcnNpc3RlbnQiPjAwNWEwNmUwLWFkODItMTEwZC1hNTU2LTAwNDAwNWIxM2EyYjwvTmFtZUlEPgogICAgPHNhbWxwOlNlc3Npb25JbmRleD4xPC9zYW1scDpTZXNzaW9uSW5kZXg+Cjwvc2FtbHA6TG9nb3V0UmVxdWVzdD4K'/>\n<input type='hidden' name='Signature' value='J4if7CCeHVfn4H6hMZN5fijOjQIyZ/laoFUZWz4LCRN3J82UeoyYvAiTDoQOUZHTRJNU1lWGub1pW4QR9MH5bwfLEa8XDivA118dR0Q7YN5L/U5rmbxnGlQ9pV0jT44cRNeqtbLW0YF4plfcqg7E5iOSljE3QLkiaAdkAec2a4HwPFkn/JP7wO11Mc6kU8MLCBbZAa3+94ZvVwHBEdyCdU+1yEvf+JGxTw66BwI2ugmPfxvoJdsOOAWwS3KhAFhLLSPXnhb3nd/ovKNNV/khZYwqsFTFNTMA+0JraKsZiCRtEZzEPXaP9KilrjPIIvRVxDQhETj96flk5zMkEM3ruw'/>\n<input type='hidden' name='SigAlg' value='http://www.w3.org/2000/09/xmldsig#rsa-sha1'/>\n</div>\n<noscript>\n<div>\n<input type='submit' value='Continua'/>\n</div>\n</noscript>\n</form>\n</body>\n</html>"
              }
            },
            "headers": {
              "Set-Cookie": {
                "description": "Contains the unique application session identifier at the SP side",
                "schema": {
                  "type": "string",
                  "example": "_opensaml_req_ss=057a4fbbb54c7d1daa09583703345565bd343546;Path=/;HttpOnly;Secure"
                }
              }
            }
          }
        }
      }
    },
    "/acs": {
      "post": {
        "tags": [
          "SP SAML"
        ],
        "summary": "The SP SAML endpoint for validating the SAML Response comes from a SAML IdP after successfully login",
        "operationId": "assertionConsumer",
        "parameters": [
          {
            "name": "state",
            "in": "cookie",
            "description": "Contains the unique application session identifier at the Wallet Instance side",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "fyZiOL9Lf2CeKuNT2JzxiLRDink0uPcd"
          },
          {
            "name": "_opensaml_req_ss",
            "in": "cookie",
            "description": "Contains the unique application session identifier at the SP side",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "057a4fbbb54c7d1daa09583703345565bd343546"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/assertionConsumerRequest"
              }
            }
          }
        },
        "responses": {
          "302": {
            "description": "Found <br> <br/> <b>No content</b> <br> <br/> => EXAMPLE Location Header:<br/> <br/> https%3A%2F%2Fwallet-sp.ipzs.it%2Fcallback",
            "headers": {
              "Location": {
                "description": "Contains the URL of the SP Callback Endpoint to redirect the web view of the Wallet Instance",
                "schema": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "Set-Cookie": {
                "description": "Contains the unique user session identifier at the SP side",
                "schema": {
                  "type": "string",
                  "example": "sp_user_session=avZU92A1ke1goP4NT2JzxiLRPink89Pqw;Path=/;HttpOnly;Secure"
                }
              }
            }
          }
        }
      }
    },
    "/callback": {
      "get": {
        "tags": [
          "SP SAML"
        ],
        "summary": "The SP SAML endpoint for forwarding authenticated user data to the /callback endpoint of the Authorization Server endpoint",
        "operationId": "callback",
        "parameters": [
          {
            "name": "state",
            "in": "cookie",
            "description": "Contains the unique application session identifier at the Wallet Instance side",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "fyZiOL9Lf2CeKuNT2JzxiLRDink0uPcd"
          },
          {
            "name": "sp_user_session",
            "in": "cookie",
            "description": "Contains the unique user session identifier at the SP side",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "avZU92A1ke1goP4NT2JzxiLRPink89Pqw"
          }
        ],
        "responses": {
          "302": {
            "description": "Found  <br> <br/> <b>No content</b> <br> <br/> <b>BINDING HTTP-REDIRECT</b> <br> <br/> => EXAMPLE Location Header: <br /><br /> https%3A%2F%2Fstart.wallet.example.org%3Fcode%3DSplxlOBeZQQYbYS6WxSbIA%26state%3DfyZiOL9Lf2CeKuNT2JzxiLRDink0uPcd%26iss%3DAxjAnj0t5qpRVgR6apZ7gChaPb6y8gNm7CkPd58PD4c",
            "headers": {
              "Location": {
                "description": "The Location response header indicates the URL  to redirect the Wallet Instance.<br/><br/>This URL present in query string: <ul><li>code (the authorization code generated by the Authorization Server)</li><li>state</i></li><li>iss</li></ul>",
                "schema": {
                  "type": "string",
                  "format": "uri"
                }
              }
            }
          },
          "200": {
            "description": "Ok <br> <br/> <b>BINDING HTTP-POST</b>, according to Section 4.3.3 of the <a target=\"blank\" href=\"https://openid.net/specs/openid-financial-api-jarm.html#response-mode-form_post.jwt\">JWT Secured Authorization Response Mode for OAuth 2.0 specification</a> <br/><br/> <a target=\"blank\" href=\"https://jwt.io/#debugger-io?token=eyJraWQiOiIxNzNhMGIxM2VkMTEzNjZmMWMxYTA5YzU3MjAxMzE4YSIsImFsZyI6IkVTMjU2IiwidHlwIjoiSldUIn0.eyJpc3MiOiJBeGpBbmowdDVxcFJWZ1I2YXBaN2dDaGFQYjZ5OGdObTdDa1BkNThQRDRjIiwiY29kZSI6IlNwbHhsT0JlWlFRWWJZUzZXeFNiSUEiLCJzdGF0ZSI6ImZ5WmlPTDlMZjJDZUt1TlQySnp4aUxSRGluazB1UGNkIn0.Uj6JDBuIIEvVUyGhZmX1_efwnTm_pHQuxh6kqZZjoopNK6_zUwzoB37IeppWGieW4b8VEe8VJyVXCcVY4NeHSg\">EXAMPLE JWT</a> included inside the 'response' parameter of the HTML form that contains the authorization code generated by the authorization server (claim 'code') and the same 'state' and 'iss' parameters were present in the PAR Request (in URL-encoded format).",
            "content": {
              "text/html": {
                "example": "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.1//EN' 'http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd'>\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\">\n<body onload=\"document.forms[0].submit()\">\n<noscript><p><strong>Note:</strong>Poiché il tuo browser non supporta JavaScript, devi premere il pulsante Continua una volta per procedere.</p></noscript>\n<form action=\"https://start.wallet.example.org\" method=\"post\">\n \t<div>\n \t\t<input type=\"hidden\" name=\"response\" value=\"eyJraWQiOiIxNzNhMGIxM2VkMTEzNjZmMWMxYTA5YzU3MjAxMzE4YSIsImFsZyI6IkVTMjU2IiwidHlwIjoiSldUIn0.eyJpc3MiOiJBeGpBbmowdDVxcFJWZ1I2YXBaN2dDaGFQYjZ5OGdObTdDa1BkNThQRDRjIiwiY29kZSI6IlNwbHhsT0JlWlFRWWJZUzZXeFNiSUEiLCJzdGF0ZSI6ImZ5WmlPTDlMZjJDZUt1TlQySnp4aUxSRGluazB1UGNkIn0.Uj6JDBuIIEvVUyGhZmX1_efwnTm_pHQuxh6kqZZjoopNK6_zUwzoB37IeppWGieW4b8VEe8VJyVXCcVY4NeHSg\">\n \t</div>\n \t<noscript><div><input type=\"submit\" value=\"Continua\"></div></noscript>\n</form>\n</body>\n</html>"
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "assertionConsumerRequest": {
        "required": [
          "SAMLResponse",
          "RelayState",
          "Signature",
          "SigAlg"
        ],
        "type": "object",
        "properties": {
          "SAMLResponse": {
            "type": "string",
            "description": "The SAML Response base64-url-encoded",
            "example": "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvVFIveGh0bWwxMS9EVEQveGh0bWwxMS5kdGQiPgo8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgeG1sOmxhbmc9ImVuIj4KPGJvZHkgb25sb2FkPSJkb2N1bWVudC5mb3Jtc1swXS5zdWJtaXQoKSI-Cjxub3NjcmlwdD4KPHA-CjxzdHJvbmc-Tm90ZTo8L3N0cm9uZz4gU2luY2UgeW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgSmF2YVNjcmlwdCwgeW91IG11c3QgcHJlc3MgdGhlIENvbnRpbnVlIGJ1dHRvbiBvbmNlIHRvIHByb2NlZWQuCjwvcD4KPC9ub3NjcmlwdD4KPGZvcm0gYWN0aW9uPSJodHRwczovL2lkcC5leGFtcGxlLm9yZy9zYW1sMi1zc28iIG1ldGhvZD0icG9zdCI-PGRpdj48aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJSZWxheVN0YXRlIiB2YWx1ZT0iMDA0M2JmYzFiYzQ1MTEwZGFlMTcwMDQwMDViMTNhMmIiLz48aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJTQU1MUmVzcG9uc2UiIHZhbHVlPSJQSE5oYld4d09reHZaMjkxZEZKbGNYVmxjM1FnZUcxc2JuTTZjMkZ0YkhBOUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcHdjbTkwYjJOdmJDSWdlRzFzYm5NOUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcGhjM05sY25ScGIyNGlDaUFnSUNCSlJEMGlaREppTjJNek9EaGpaV016Tm1aaE4yTXpPV015T0daa01qazROalEwWVRnaUlFbHpjM1ZsU1c1emRHRnVkRDBpTWpBd05DMHdNUzB5TVZReE9Ub3dNRG8wT1ZvaUlGWmxjbk5wYjI0OUlqSXVNQ0krQ2lBZ0lDQThTWE56ZFdWeVBtaDBkSEJ6T2k4dlNXUmxiblJwZEhsUWNtOTJhV1JsY2k1amIyMHZVMEZOVER3dlNYTnpkV1Z5UGdvZ0lDQWdQRTVoYldWSlJDQkdiM0p0WVhROUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcHVZVzFsYVdRdFptOXliV0YwT25CbGNuTnBjM1JsYm5RaVBqQXdOV0V3Tm1Vd0xXRmtPREl0TVRFd1pDMWhOVFUyTFRBd05EQXdOV0l4TTJFeVlqd3ZUbUZ0WlVsRVBnb2dJQ0FnUEhOaGJXeHdPbE5sYzNOcGIyNUpibVJsZUQ0eFBDOXpZVzFzY0RwVFpYTnphVzl1U1c1a1pYZytDand2YzJGdGJIQTZURzluYjNWMFVtVnhkV1Z6ZEQ0SyIvPgo8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJTaWduYXR1cmUiIHZhbHVlPSJEQ0RxQXdJRHFTd3lYR3ZHMmNZdk5qbWo3UDFrdDAra2JDZlJqcTlnR1RyTjRLS1B4dlFsNUVzRnJXUmtNT2R4eHV3UGxkV1BLdmZnWDZydCtwS3dMZ0N0MVRxUmorNzF5K1ZkR1M4T1JzQmVFSVVSUm45d1N1K3BLc1dpSGV4d0tuSWU2NWJqT05iZzJkYjQ0UU9XWmxEZTc2ZkxpMDVQc3kvN0haVFF1TW9EUkZZU1IvL1Z5TkdIUW1mOVN4aTZta21yWU1YUE95WkFVZk5oWDRlTGFYRmZ3Q0h0MHlSckVjbS9QQUVERGE3dXFlOFVvNWlsc3RnWERXRG9kV2RrU3prOFpTMWlyakZrdnR4SDdGSmxtOUFEdGxXL1NvWDkyakdqTUlyZFF3Q3lBckk2bzhLVGlEcC9jakRqSFpHaVhMeDJXdlM3R0VpYkE3UWQrNWhTQlE9PSIvPgo8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJTaWdBbGciIHZhbHVlPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz4KPC9kaXY-Cjxub3NjcmlwdD4KPGRpdj4KPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkNvbnRpbnVlIi8-CjwvZGl2Pgo8L25vc2NyaXB0Pgo8L2Zvcm0-CjwvYm9keT4KPC9odG1sPg"
          },
          "Signature": {
            "type": "string",
            "description": "The sign of the SAML Response base64-url-encoded",
            "example": "Signature' value='J4if7CCeHVfn4H6hMZN5fijOjQIyZ/laoFUZWz4LCRN3J82UeoyYvAiTDoQOUZHTRJNU1lWGub1pW4QR9MH5bwfLEa8XDivA118dR0Q7YN5L/U5rmbxnGlQ9pV0jT44cRNeqtbLW0YF4plfcqg7E5iOSljE3QLkiaAdkAec2a4HwPFkn/JP7wO11Mc6kU8MLCBbZAa3+94ZvVwHBEdyCdU+1yEvf+JGxTw66BwI2ugmPfxvoJdsOOAWwS3KhAFhLLSPXnhb3nd/ovKNNV/khZYwqsFTFNTMA+0JraKsZiCRtEZzEPXaP9KilrjPIIvRVxDQhETj96flk5zMkEM3ruw"
          },
          "SigAlg": {
            "type": "string",
            "description": "The signature algorithm",
            "example": "http://www.w3.org/2000/09/xmldsig#rsa-sha1"
          },
          "RelayState": {
            "type": "string",
            "description": "The unique login request identifier previously received from the client",
            "example": "0043bfc1bc45110dae17004005b13a2b"
          }
        },
        "description": "The Assertion consumer Request"
      }
    }
  }
}